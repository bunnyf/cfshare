# cfshare

é€šè¿‡ Cloudflare Tunnel å¿«é€Ÿåˆ†äº«æœ¬åœ°æ–‡ä»¶æˆ–ç›®å½•ï¼Œä¸€æ¡å‘½ä»¤å³å¯ç”Ÿæˆå…¬ç½‘å¯è®¿é—®çš„ä¸‹è½½é“¾æ¥ã€‚

## ç‰¹æ€§

- ğŸš€ **ä¸€é”®åˆ†äº«** - å•å‘½ä»¤åˆ†äº«æ–‡ä»¶æˆ–ç›®å½•
- ğŸ”’ **é»˜è®¤å®‰å…¨** - è‡ªåŠ¨ç”Ÿæˆè®¿é—®å£ä»¤ï¼ˆBasic Authï¼‰
- ğŸŒ **å…¨çƒåŠ é€Ÿ** - é€šè¿‡ Cloudflare è¾¹ç¼˜ç½‘ç»œæä¾›è®¿é—®
- ğŸ”“ **å¯é€‰å…¬å¼€** - æ”¯æŒ \`--public\` åŒ¿ååˆ†äº«
- ğŸ“Š **è®¿é—®ç»Ÿè®¡** - è®°å½•è¯·æ±‚æ•°ã€æœ€è¿‘è®¿é—®æ—¶é—´
- ğŸ¯ **åå°è¿è¡Œ** - å‘½ä»¤æ‰§è¡Œåç«‹å³è¿”å›ç»ˆç«¯

## å¿«é€Ÿå¼€å§‹

```bash
# åˆ†äº«æ–‡ä»¶ï¼ˆè‡ªåŠ¨ç”Ÿæˆå£ä»¤ï¼‰
cfshare ~/Documents/report.pdf

# è¾“å‡ºç¤ºä¾‹ï¼š
# âœ… åˆ†äº«å·²å¯åŠ¨
# URL:      https://share.yourdomain.com
# Path:     /Users/you/Documents/report.pdf
# Type:     file
# Mode:     protected
# Username: dl
# Password: xK9mQ2pR7wN4vB3j

# åœæ­¢åˆ†äº«
cfshare stop
```

## å®Œæ•´å®‰è£…æŒ‡å—

### ç¬¬ä¸€æ­¥ï¼šå®‰è£…ä¾èµ–

```bash
# macOS
brew install go cloudflared
```

### ç¬¬äºŒæ­¥ï¼šç¼–è¯‘å®‰è£… cfshare

```bash
cd cfshare
make build

# å®‰è£…åˆ° ~/binï¼ˆæ¨èï¼Œé¿å… macOS å®‰å…¨é™åˆ¶ï¼‰
mkdir -p ~/bin
cp cfshare ~/bin/

# æ·»åŠ åˆ° PATH
echo 'export PATH="\$HOME/bin:\$PATH"' >> ~/.zshrc
source ~/.zshrc
```

### ç¬¬ä¸‰æ­¥ï¼šé…ç½® Cloudflare Tunnel

ä½ éœ€è¦ä¸€ä¸ª Cloudflare è´¦å·å’Œä¸€ä¸ªå·²æ‰˜ç®¡åœ¨ Cloudflare çš„åŸŸåã€‚

#### 3.1 ç™»å½• Cloudflare

```bash
cloudflared tunnel login
```

è¿™ä¼šæ‰“å¼€æµè§ˆå™¨ï¼Œé€‰æ‹©ä½ è¦ä½¿ç”¨çš„åŸŸåè¿›è¡Œæˆæƒã€‚

#### 3.2 åˆ›å»º Tunnel

```bash
cloudflared tunnel create cfshare
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
Tunnel credentials written to /Users/ä½ çš„ç”¨æˆ·å/.cloudflared/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx.json
Created tunnel cfshare with id xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
```

**è®°ä¸‹è¿™ä¸ª JSON æ–‡ä»¶è·¯å¾„ï¼Œåé¢è¦ç”¨ã€‚**

#### 3.3 é…ç½® DNS

```bash
# æ›¿æ¢ share.yourdomain.com ä¸ºä½ çš„å­åŸŸå
cloudflared tunnel route dns cfshare share.yourdomain.com
```

#### 3.4 åˆ›å»ºé…ç½®æ–‡ä»¶

åˆ›å»º \`~/.cloudflared/config.yml\`ï¼š

```yaml
tunnel: cfshare
credentials-file: /Users/ä½ çš„ç”¨æˆ·å/.cloudflared/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx.json

ingress:
  - hostname: share.yourdomain.com
    service: http://localhost:8787
  - service: http_status:404
```

**æ³¨æ„ï¼š** 
- æŠŠ \`credentials-file\` æ”¹æˆç¬¬ 3.2 æ­¥è¾“å‡ºçš„å®é™…è·¯å¾„
- æŠŠ \`hostname\` æ”¹æˆä½ çš„å®é™…åŸŸå

#### 3.5 éªŒè¯é…ç½®

```bash
cfshare setup
```

å¦‚æœçœ‹åˆ° \`âœ… Cloudflare Tunnel é…ç½®æ­£ç¡®\`ï¼Œè¯´æ˜é…ç½®æˆåŠŸã€‚

## ä½¿ç”¨æ–¹æ³•

### åˆ†äº«æ–‡ä»¶/ç›®å½•

```bash
# åˆ†äº«æ–‡ä»¶ï¼ˆéœ€è¦å£ä»¤ï¼Œè‡ªåŠ¨ç”Ÿæˆï¼‰
cfshare ~/Documents/report.pdf

# åˆ†äº«ç›®å½•ï¼ˆå¯æµè§ˆç›®å½•åˆ—è¡¨ï¼‰
cfshare ~/Pictures

# å…¬å¼€åˆ†äº«ï¼ˆæ— éœ€å£ä»¤ï¼‰
cfshare ~/public --public

# ä½¿ç”¨æŒ‡å®šå£ä»¤
cfshare ~/file.txt --pass mypassword

# ä¹Ÿå¯ä»¥æŠŠ --public æ”¾åé¢
cfshare ~/file.txt --public
```

### çŠ¶æ€ç®¡ç†

```bash
# æŸ¥çœ‹å½“å‰åˆ†äº«çŠ¶æ€
cfshare

# æŸ¥çœ‹è¯¦ç»†çŠ¶æ€
cfshare status

# åœæ­¢åˆ†äº«
cfshare stop

# å¼ºåˆ¶åœæ­¢
cfshare stop --force

# æŸ¥çœ‹è®¿é—®æ—¥å¿—
cfshare logs
```

## å‘½ä»¤å‚è€ƒ

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| \`cfshare <path>\` | åˆ†äº«æ–‡ä»¶/ç›®å½•ï¼ˆéœ€å£ä»¤ï¼‰ |
| \`cfshare <path> --public\` | å…¬å¼€åˆ†äº«ï¼ˆæ— éœ€å£ä»¤ï¼‰ |
| \`cfshare <path> --pass <pwd>\` | ä½¿ç”¨æŒ‡å®šå£ä»¤ |
| \`cfshare\` | æŸ¥çœ‹å½“å‰åˆ†äº«çŠ¶æ€ |
| \`cfshare status\` | æŸ¥çœ‹è¯¦ç»†çŠ¶æ€ |
| \`cfshare stop\` | åœæ­¢åˆ†äº« |
| \`cfshare stop --force\` | å¼ºåˆ¶åœæ­¢ |
| \`cfshare logs\` | æŸ¥çœ‹è®¿é—®æ—¥å¿— |
| \`cfshare setup\` | æ£€æŸ¥ Tunnel é…ç½® |

### é€‰é¡¹

| é€‰é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| \`--public\` | å…¬å¼€åˆ†äº«ï¼Œæ— éœ€è®¤è¯ | false |
| \`--pass <pwd>\` | æŒ‡å®šå£ä»¤ | éšæœº 16 ä½ |
| \`--port <port>\` | æœ¬åœ°ç›‘å¬ç«¯å£ | 8787 |
| \`--tunnel <name>\` | Tunnel åç§° | cfshare |
| \`--url <url>\` | å…¬å¼€è®¿é—® URL | è‡ªåŠ¨æ£€æµ‹ |

## æ¶æ„

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Internet                             â”‚
â”‚                     ç”¨æˆ·è®¿é—® URL                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Cloudflare Edge (share.yourdomain.com)            â”‚
â”‚                    å…¨çƒè¾¹ç¼˜èŠ‚ç‚¹åŠ é€Ÿ                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    cloudflared tunnel                        â”‚
â”‚                  (æœ¬åœ°åå°è¿›ç¨‹ï¼Œå›ºå®šé…ç½®)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              cfshare æ–‡ä»¶æœåŠ¡å™¨ (localhost:8787)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â€¢ Basic Auth è®¤è¯ï¼ˆå¯é€‰ï¼‰                              â”‚ â”‚
â”‚  â”‚  â€¢ å•æ–‡ä»¶æ¨¡å¼ / ç›®å½•æµè§ˆæ¨¡å¼                            â”‚ â”‚
â”‚  â”‚  â€¢ è®¿é—®æ—¥å¿—å’Œç»Ÿè®¡                                       â”‚ â”‚
â”‚  â”‚  â€¢ ç›®å½•ç©¿è¶Šé˜²æŠ¤                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

## å®‰å…¨ç‰¹æ€§

- **é»˜è®¤è®¤è¯** - HTTP Basic Authï¼Œå£ä»¤éšæœºç”Ÿæˆ 16 ä½
- **ç›®å½•ç©¿è¶Šé˜²æŠ¤** - ç¦æ­¢è®¿é—®åˆ†äº«ç›®å½•ä»¥å¤–çš„æ–‡ä»¶
- **ç¬¦å·é“¾æ¥é™åˆ¶** - ä¸è·ŸéšæŒ‡å‘åˆ†äº«ç›®å½•å¤–çš„ç¬¦å·é“¾æ¥
- **æ— ç¼“å­˜** - å“åº”å¤´è®¾ç½® \`Cache-Control: no-store\`
- **çŠ¶æ€æ–‡ä»¶æƒé™** - ä½¿ç”¨ 0600 æƒé™ä¿æŠ¤æ•æ„Ÿä¿¡æ¯
- **å¸¸é‡æ—¶é—´æ¯”è¾ƒ** - é˜²æ­¢æ—¶åºæ”»å‡»

## æ–‡ä»¶ä½ç½®

| æ–‡ä»¶ | è·¯å¾„ |
|------|------|
| é…ç½®ç›®å½• | \`~/.cfshare/\` |
| çŠ¶æ€æ–‡ä»¶ | \`~/.cfshare/state.json\` |
| è®¿é—®æ—¥å¿— | \`~/.cfshare/access.log\` |
| æœåŠ¡å™¨æ—¥å¿— | \`~/.cfshare/server.log\` |
| Tunnel æ—¥å¿— | \`~/.cfshare/tunnel.log\` |
| Tunnel é…ç½® | \`~/.cloudflared/config.yml\` |

## æ•…éšœæ’é™¤

### macOS æç¤º "killed" æˆ–æ— æ³•è¿è¡Œ

è¿™æ˜¯ macOS å®‰å…¨æœºåˆ¶å¯¼è‡´çš„ã€‚è§£å†³æ–¹æ¡ˆï¼š

```bash
# å®‰è£…åˆ° ~/bin è€Œä¸æ˜¯ /usr/local/bin
mkdir -p ~/bin
cp cfshare ~/bin/
```

### cloudflared æœªæ‰¾åˆ°

```bash
brew install cloudflared
```

### Tunnel è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥ tunnel çŠ¶æ€
cloudflared tunnel list
cloudflared tunnel info cfshare

# æŸ¥çœ‹ tunnel æ—¥å¿—
cat ~/.cfshare/tunnel.log
```

### åˆ†äº«æ— æ³•è®¿é—®

```bash
# æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦è¿è¡Œ
cfshare status

# æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
cat ~/.cfshare/server.log

# æµ‹è¯•æœ¬åœ°è¿æ¥
curl -u dl:å¯†ç  http://localhost:8787
```

### å¼ºåˆ¶æ¸…ç†

```bash
# åœæ­¢æ‰€æœ‰ç›¸å…³è¿›ç¨‹
cfshare stop --force

# æ‰‹åŠ¨æ¸…ç†
pkill -f "cfshare __server__"
pkill -f "cloudflared tunnel run"
rm -rf ~/.cfshare/
```

## å•å®ä¾‹ç­–ç•¥

åŒæ—¶åªå…è®¸ä¸€ä¸ªæ´»åŠ¨åˆ†äº«ã€‚æ‰§è¡Œæ–°çš„ \`cfshare <path>\` æ—¶ä¼šè‡ªåŠ¨åœæ­¢æ—§åˆ†äº«ã€‚

## ç³»ç»Ÿè¦æ±‚

- macOS / Linux
- Go 1.21+ (ç¼–è¯‘æ—¶éœ€è¦)
- cloudflared (Cloudflare Tunnel å®¢æˆ·ç«¯)
- æ‰˜ç®¡åœ¨ Cloudflare çš„åŸŸå

## å·²çŸ¥é™åˆ¶

- åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªæ´»åŠ¨åˆ†äº«
- ä¸æ”¯æŒ Windows (æš‚æ—¶)
- å¤§æ–‡ä»¶ä¼ è¾“å— Cloudflare å…è´¹è®¡åˆ’é™åˆ¶ (100MB/è¯·æ±‚)

## License

MIT
